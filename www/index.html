<!DOCTYPE html>
<!--
Outil de fabrication de question QCM au format GIFT et XML pour Moodle
(c) obooklage Académie de Créteil - Académie de Bordeaux
06/05/2020 - 08/03/2024
-->
<html lang="fr">
<head>
    <meta charset="UTF-8">
	<title>Moodle MCQ GIFT Maker</title>

    <!-- Jquery/JQueryMobile -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="./images/moodle-icon.png" type="image/icon">
	<link rel="stylesheet" href="vendor/jquery.mobile-1.4.5/jquery.mobile-1.4.5.min.css">
	<script src="vendor/jquerymobile.com_1.4.5_js_jquery.js"></script>
	<script src="vendor/jquery.mobile-1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script src="vendor/jqm-spinbox.min.js"></script>
    <!-- Mathjax -->
	<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

    <!-- Styles -->
    <link rel="stylesheet" type="text/css" href="css/index.css">
</head>
<body class="no-mathjax">

<!-- Main page -->
<div data-role="page" id="index" data-theme="b">

    <!-- Panel Settings -->
    <div data-role="panel" id="settingspanel" data-display="overlay">
        <label for="id_theme">Category:</label>
        <input type="text" name="id_theme" id="id_theme" value="My bank category">
        <label for="sliderOutput">Code:</label>
        <select name="sliderOutput" id="sliderOutput" data-role="slider" data-mini="true">
            <option value="GIFT" selected>GIFT</option>
            <option value="XML">XML</option>
        </select>

        <select name="select-h-1a" id="id_question_type">
            <option value="1">One correct awswer</option>
            <option value="2">Two correct awswers</option>
            <option value="3">Three correct awswers</option>
            <option value="4">Four correct awswers</option>
        </select>

        <select name="select-h-1b" id="id_points_negatifs">
            <option value="1">With negative points</option>
            <option value="0">Without negative points</option>
        </select>

        <a href="#" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-icon-delete ui-btn-icon-left">Close</a>
    </div><!-- /panel Settings -->

    <!-- Panel Sample -->
    <div data-role="panel" id="samplepanel" data-display="overlay">

        <p><b>Code snippet</b>
<textarea readonly name="textareaPython" id="textareaPython">Question about Python.
<pre><code>def Strange(x) :
    y=2*x+5
    return(y)
</code></pre>What return Strange(0)?</textarea></p>
<p><b>LaTeX Math</b>
<textarea readonly name="textareaMathJax" id="textareaMathJax">
Inline \( \sqrt{2} \)
Displayed $$ 2x^2-3x+1 $$</textarea></p>

        <a href="#" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-icon-delete ui-btn-icon-left">Close</a>
    </div><!-- /panel Sample -->

    <!-- Header -->
	<div data-role="header" data-position="fixed" data-tap-toggle="false" data-theme="b"> <!-- style="height: 16em;" -->
        <a href="#settingspanel" class="ui-btn ui-shadow ui-corner-all ui-btn-inline ui-btn-icon-left ui-icon-gear">Settings</a>
		<h1 id="id_header">Moodle MCQ GIFT Maker</h1>
	</div><!-- /header -->

    <!-- Content -->
	<div role="main" class="ui-content">

	    <!-- <p>LaTeX : les symboles { et } DOIVENT avoir un anti-slash devant, comme \{ et \}, c'est valable pour tous les caractères spéciaux ~ = # { }</p> -->
        <div data-role="collapsible" data-collapsed="false" data-theme="b" data-content-theme="b" data-collapsed-icon="carat-d" data-expanded-icon="carat-u">
            <h4>Question</h4>

            <div class="ui-grid-a">
                <div class="ui-block-a">
                    <input type="text" data-role="spinbox" name="numero" id="id_numero" value="1" min="1" max="100">
                </div>
                <div class="ui-block-b"></div>
                    <div style="float:right">
                        <a href="#samplepanel" class="ui-btn ui-shadow ui-corner-all ui-btn-inline ui-icon-edit ui-btn-icon-right">Samples</a> 
                        <div class="ui-block-c"><a href="#" id="id_reset" class="ui-btn ui-shadow ui-corner-all ui-btn-inline ui-btn-icon-right ui-icon-delete">Reset</a>
                    </div>
                </div>
            </div>

            <div class="ui-grid-a">
                <div class="ui-block-a" style="padding-left: 7px;">Editor</div>
                <div class="ui-block-b" style="padding-left: 7px;">Preview</div>
                <div class="ui-block-a">
<textarea name="textarea" id="id_question" style="height: 100%;">Consider the following Python program.
<pre><code>x=4
if 3*x-6<0 :
    x=1
    r=-1
else :
    x=-1
    r=1</code></pre>What does the variable r contain at the end of the program?</textarea>
                </div>
                <div class="ui-block-b">
                    <div id="id_preview" class="mathjax ui-bar ui-bar-a"></div>
                </div>
            </div><!-- /grid-c -->
        </div>

        <div data-role="collapsible" data-collapsed="false" data-theme="b" data-content-theme="b" data-collapsed-icon="carat-d" data-expanded-icon="carat-u">
            <h4>Answers</h4>
              <div class="ui-field-contain">

                <label for="id_reponse1">Answer 1 (correct) :</label>
                <input type="text" class='class_answer' name="reponse1" id="id_reponse1" value="5">

                <label for="id_reponse2">Answer 2:</label>
                <input type="text" class='class_answer' name="reponse2" id="id_reponse2" value="0">

                <label for="id_reponse3">Answer 3:</label>
                <input type="text" class='class_answer' name="reponse3" id="id_reponse3" value="x">

                <label for="id_reponse4">Answer 4:</label>
                <input type="text" class='class_answer' name="reponse4" id="id_reponse4" value="2">
              </div>
        </div>

        <div data-role="collapsible" data-collapsed="true" data-theme="b" data-content-theme="b" data-collapsed-icon="carat-d" data-expanded-icon="carat-u">
            <h4>Global feedback (optionnal)</h4>
            <textarea cols="80" rows="5" name="textarea" id="id_feedback"></textarea>
        </div>

        <div data-role="collapsible" data-collapsed="false" data-collapsed-icon="carat-d" data-expanded-icon="carat-u" data-theme="b" data-content-theme="b">
            <h4><span id="id_outype">Code</span> (copy into a text editor then import in questions bank)</h4>
            <form>
                <div class="ui-field-contain">
                   <label for="sliderBank">Question only:</label>
                                <select class="ui-shadow" name="sliderBank" id="sliderBank" data-role="slider" data-mini="true">
                                    <option value="OFF" selected>OFF</option>
                                    <option value="ON">ON</option>
                                </select>
                 </div>
            </form>

            <div id="id_code"></div>
            
            <div class="ui-grid-a">
                <div class="ui-block-a">
                    <a href="#" id="copy-button" class="ui-shadow ui-btn ui-corner-all ui-btn-icon-left ui-icon-grid">COPY</a>
                </div>
                <div class="ui-block-b"></div>
                    <a href="#" id="save-button" class="ui-shadow ui-btn ui-corner-all ui-btn-icon-left ui-icon-action">SAVE</a>
                </div>
            </div>
        
	</div><!-- /content -->

    <!-- footer -->
	<div data-role="footer" data-position="fixed" data-tap-toggle="false" data-theme="b">
		<h4>Moodle MCQ GIFT/XML Maker - ADM 2020/SMB33 2024 - <a href='https://github.com/obook/MoodleMCQMaker' target='_blank'>GitHub</a></h4>
	</div><!-- /footer -->

    <!-- Scripts -->
	<script>

    let IndexModule=null;

    /* Events */

    $(document).delegate('.ui-page', 'pageshow', function () {
        console.log("pageshow");
        // Init();
	});

	$(document).on("pagecreate", "#index", function() {
		console.log('pagecreate@index');
	});

    $(document).on("pagebeforeshow", "#index", function() {
        console.log('pagebeforeshow@index');
    });

    $(document).on("pageaftershow", "#index", function() {
        console.log('pageaftershow@index');
    });

	$( "#id_reset" ).click(function() {
		if ( confirm( "Clear all ?" ) )
		{
            IndexModule.ClearAll();
		}
	});

    $("#sliderOutput").change(function() {
        IndexModule.SetFormatOutput($("#sliderOutput").val());
	});

    $("#id_numero").change(function() {
        //$("#id_numero").addClass("ui-disabled");
        IndexModule.QuestionNumberChanged($("#id_numero").val());
        //$("#id_numero").removeClass("ui-disabled");
	});

    $("#sliderBank").change(function() {
        IndexModule.SetQuestionOnly($("#sliderBank").val());
	});

    /* Clipboard */
    $('#copy-button').click(function() {
        let textToCopy = $("#id_code").text();
        let tempTextarea = $("<textarea id='id_tempcode'>");
        $('body').append(tempTextarea);
        tempTextarea.val(textToCopy).select();
        document.execCommand("copy");
        $('#copy-button').fadeOut(300).fadeIn(0);
    });

    $('#save-button').click(function() {
        //$('#save-button').fadeOut(300).fadeIn(0);
        // 
        // SaveGift();
        IndexModule.SaveCode();
    });

    </script><!-- /Scripts -->

</div><!-- /page -->

<!-- Main script -->
<script type="module">
    import * as M from "./js/index.js";
    IndexModule = M;
</script>

<!-- MathJax Settings-->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
    inlineMath: [['$','$'],['\\(','\\)']],
    processClass: "mathjax",
    ignoreClass: "no-mathjax"
}
});
</script>
</body>
</html>